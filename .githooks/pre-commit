#!/usr/bin/env bash

set -e

# Check if there are any staged changes in docs
if git diff --cached --name-only | grep -q "^docs/"; then
  echo "Running pre-commit checks for docs..."

  cd docs

  pnpm install --lockfile-only --frozen-lockfile
  pnpm run typecheck
  pnpm run format:check
  pnpm run lint:check
  pnpm build

  echo "✓ Checks passed for docs"
  cd ../
fi

# Check if there are any staged changes in packages/flutter_query
if git diff --cached --name-only | grep -q "^packages/flutter_query/"; then
  echo "Running pre-commit checks for flutter_query..."

  cd packages/flutter_query

  flutter analyze
  flutter pub run import_sorter:main --exit-if-changed
  dart format --output none --set-exit-if-changed .
  flutter test

  echo "✓ Checks passed for packages/flutter_query"
  cd ../..
fi
